bulletML(vertical,[
  top:action([actionRef(allway,[]),actionRef(bar,[]),wait(200)]),
  allway:action([
    fire(dirAim(15),spdAbs(1),bulletRef(allwaybit,[])),
    repeat(11,[action([fire(dirSeq(30),spdAbs(1),bulletRef(allwaybit,[]))])])
  ]),
  allwaybit:bullet(dirAim(0),spdAbs(6.0),[
    action([
      repeat(999,[
        action([
          fire(dirRel(90),spdAbs(1),bulletRef(stopandgo,[])),
          fire(dirRel(- 90),spdAbs(1),bulletRef(stopandgo,[])),
          wait(6-4* $rank)
        ])
      ])
    ])
  ]),
  stopandgo:bullet(dirAim(0),spdAbs(1.0),[
    action([
      wait(20),
      changeSpeed(spdAbs(0.0001),1),
      wait(40),
      changeSpeed(spdAbs(4.0),300)
    ])
  ]),
  bar:action([
    fire(dirAim(0),spdAbs(1),bulletRef(barhand,[1])),
    fire(dirAim(0),spdAbs(1),bulletRef(barhand,[- 1]))
  ]),
  barhand:bullet(dirAbs(0),spdAbs(0.0001),[
    action([
      fire(dirAbs(90),spdAbs(4.0-2.0* $rank),bulletRef(barbit,[1])),
      repeat(2+3* $rank,[action([fire(dirSeq(0),spdSeq(4.0-2.0* $rank),bulletRef(barbit,[1]))])]),
      fire(dirSeq(180),spdAbs(4.0-2.0* $rank),bulletRef(barbit,[- 1])),
      repeat(2+3* $rank,[action([fire(dirSeq(0),spdSeq(4.0-2.0* $rank),bulletRef(barbit,[- 1]))])]),
      wait(5),
      repeat(20,[
        action([
          fire(dirSeq(180+10* $1),spdAbs(4.0-2.0* $rank),bulletRef(barbit,[1])),
          repeat(2+3* $rank,[action([fire(dirSeq(0),spdSeq(4.0-2.0* $rank),bulletRef(barbit,[1]))])]),
          fire(dirSeq(180),spdAbs(4.0-2.0* $rank),bulletRef(barbit,[- 1])),
          repeat(2+3* $rank,[action([fire(dirSeq(0),spdSeq(4.0-2.0* $rank),bulletRef(barbit,[- 1]))])]),
          wait(5)
        ])
      ]),
      vanish
    ])
  ]),
  barbit:bullet(dirAim(0),spdAbs(1),[
    action([
      wait(5),
      changeSpeed(spdAbs(0.0001),1),
      wait(5),
      fire(dirRel(90* $1),spdAbs(1.3),bullet(dirAim(0),spdAbs(1),[])),
      repeat(2,[action([fire(dirSeq(0),spdSeq(0.1),bullet(dirAim(0),spdAbs(1),[]))])]),
      vanish
    ])
  ])
]).
