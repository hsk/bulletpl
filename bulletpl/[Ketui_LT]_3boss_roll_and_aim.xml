bulletML(vertical,[
  ebullet('Dummy',bullet(none,none,[action([vanish])])),
  eaction('XWay',[actionRef('XWayFan',[$1,$2,0])]),
  eaction('XWayFan',[
    repeat($1-1,[action([fire(some(dirSeq($2)),some(spdSeq($3)),bullet(none,none,[]))])])
  ]),
  ebullet(curve,bullet(none,none,[
    action([
      repeat(9999,[action([changeDirection(dirRel(- $1*(4+rank*rank*4)),10),wait(10)])])
    ])
  ])),
  eaction(spiral,[
    wait(rand*30),
    repeat(10+rank*15,[
      action([
        repeat(2,[
          action([
            fire(some(dirSeq($1*5)),some(spdAbs(1.5+rank*rank*1.5)),bulletRef(curve,[$1])),
            repeat(4,[action([fire(some(dirSeq(90)),some(spdSeq(0)),bulletRef(curve,[$1]))])]),
            wait(6+rand*3)
          ])
        ]),
        wait(6),
        fire(some(dirSeq($1)),some(spdAbs(1+rank*2)),bulletRef('Dummy',[]))
      ])
    ])
  ]),
  eaction(twoWay,[
    repeat(5+rank*4,[
      action([
        repeat(3+rank*4,[
          action([
            fire(some(dirAim(3)),some(spdAbs(1.8)),bullet(none,none,[])),
            fire(some(dirAim(- 3)),some(spdAbs(1.8)),bullet(none,none,[])),
            wait(5)
          ])
        ]),
        wait(20)
      ])
    ])
  ]),
  eaction(top1,[actionRef(spiral,[- 2])]),
  eaction(top2,[actionRef(spiral,[2])]),
  eaction(top3,[actionRef(twoWay,[])])
]).
