bulletML(vertical,[
  eaction(top,[
    fire(none,none,bulletRef(dummy,[2.5,1.2*(0.5+0.5*rank),11*(3.5-2.5*rank),0,10])),
    fire(none,none,bulletRef(dummy,[1.5,1.5*(0.5+0.5*rank),7*(3.5-2.5*rank),0,- 8])),
    fire(none,none,bulletRef(dummy,[0.5,1.8*(0.5+0.5*rank),5*(3.5-2.5*rank),0,6])),
    wait(1050-150*rank)
  ]),
  ebullet(dummy,bullet(some(dirAbs(180)),some(spdAbs(2.0)),[
    action([
      wait(15),
      changeSpeed(spdAbs(0),1),
      wait(15),
      fire(some(dirAbs(360*rand)),some(spdAbs($1)),bulletRef(bit,[$2,$3,$4,$5])),
      repeat(3,[
        action([fire(some(dirSeq(90)),some(spdAbs($1)),bulletRef(bit,[$2,$3,$4,$5]))])
      ]),
      wait(20),
      repeat(2,[
        action([
          fire(some(dirSeq(30)),some(spdAbs($1)),bulletRef(bit,[$2,$3,$4,$5])),
          repeat(3,[
            action([fire(some(dirSeq(90)),some(spdAbs($1)),bulletRef(bit,[$2,$3,$4,$5]))])
          ]),
          wait(20)
        ])
      ]),
      repeat(200 div $3,[
        action([
          fire(some(dirSeq($5*2.5)),some(spdAbs($2*0.6)),bullet(none,none,[])),
          repeat(3,[
            action([fire(some(dirSeq(0)),some(spdSeq($2*0.05)),bullet(none,none,[]))])
          ]),
          repeat(2,[
            action([
              fire(some(dirSeq(120)),some(spdAbs($2*0.6)),bullet(none,none,[])),
              repeat(3,[
                action([fire(some(dirSeq(0)),some(spdSeq($2*0.05)),bullet(none,none,[]))])
              ])
            ])
          ]),
          wait($3*3)
        ])
      ]),
      vanish
    ])
  ])),
  ebullet(bit,bullet(none,none,[
    action([
      wait(15),
      changeSpeed(spdAbs(0.001),1),
      wait(1),
      changeDirection(dirRel(- (17* $4)),1),
      wait(1),
      wait(200-100*rank),
      changeSpeed(spdAbs(0.13),1),
      wait(1),
      fire(some(dirRel($3)),some(spdAbs($1)),bullet(none,none,[])),
      wait($2),
      repeat(96 div $2,[
        action([
          repeat(3,[
            action([
              fire(some(dirSeq($4)),some(spdSeq(- ($1*0.1))),bullet(none,none,[])),
              wait($2)
            ])
          ]),
          repeat(3,[
            action([
              fire(some(dirSeq($4)),some(spdSeq($1*0.1)),bullet(none,none,[])),
              wait($2)
            ])
          ])
        ])
      ]),
      vanish
    ])
  ]))
]).
