bulletML(vertical,[
  'Stop':action([changeSpeed(spdAbs(0),1)]),
  'XWay':action([
    repeat($1-1,[action([fire(dirSeq($2),spdSeq(0),bullet(dirAim(0),spdAbs(1),[]))])])
  ]),
  'Dummy':bullet(dirAim(0),spdAbs(1),[action([vanish])]),
  blueFan:bullet(dirAim(0),spdAbs(3),[
    action([
      wait(20),
      actionRef('Stop',[]),
      repeat(6,[
        action([
          fire(dirSeq(120+ $1*2),spdAbs(1.6),bullet(dirAim(0),spdAbs(1),[])),
          actionRef('XWay',[3,120]),
          repeat(6+ $rank*6,[
            action([
              wait(56/(6+ $rank*6)),
              fire(dirSeq(120+ $1),spdAbs(1.6),bullet(dirAim(0),spdAbs(1),[])),
              actionRef('XWay',[3,120])
            ])
          ]),
          wait(14)
        ])
      ]),
      vanish
    ])
  ]),
  singleRedAim:action([
    fire(dirAim(0),spdAbs(2),bullet(dirAim(0),spdAbs(1),[action([])])),
    repeat(15,[
      action([wait(4),fire(dirSeq(0),spdAbs(2),bullet(dirAim(0),spdAbs(1),[action([])]))])
    ])
  ]),
  doubleRedAim:action([
    fire(dirAim(- 5* $1),spdAbs(2),bullet(dirAim(0),spdAbs(1),[action([])])),
    fire(dirSeq(20* $1),spdAbs(2),bullet(dirAim(0),spdAbs(1),[action([])])),
    repeat(15,[
      action([
        wait(4),
        fire(dirSeq(- 20* $1),spdAbs(2),bullet(dirAim(0),spdAbs(1),[action([])])),
        fire(dirSeq(20* $1),spdAbs(2),bullet(dirAim(0),spdAbs(1),[action([])]))
      ])
    ])
  ]),
  redAim2:bullet(dirAim(0),spdAbs(1),[
    action([
      wait(20),
      actionRef('Stop',[]),
      wait(100),
      actionRef(singleRedAim,[]),
      wait(60),
      actionRef(doubleRedAim,[- 1]),
      wait(20),
      actionRef(doubleRedAim,[- 1]),
      vanish
    ])
  ]),
  redAim1:bullet(dirAim(0),spdAbs(1),[
    action([
      wait(20),
      actionRef('Stop',[]),
      wait(40),
      actionRef(singleRedAim,[]),
      wait(60),
      actionRef(doubleRedAim,[1]),
      wait(80),
      actionRef(doubleRedAim,[1]),
      vanish
    ])
  ]),
  top:action([
    fire(dirAbs(90),spdAbs(1),bulletRef(blueFan,[4])),
    fire(dirAbs(- 90),spdAbs(1),bulletRef(blueFan,[- 4])),
    fire(dirAbs(90),spdAbs(1),bulletRef(redAim2,[])),
    fire(dirAbs(- 90),spdAbs(1),bulletRef(redAim1,[])),
    wait(400)
  ])
]).
