bulletML(vertical,[
  eaction(top,[
    actionRef(bara,[1]),
    actionRef(bara,[- 1]),
    actionRef('3way',[180-55,- 5]),
    actionRef('3way',[180,0]),
    actionRef('3way',[180+55,5]),
    actionRef(roll,[180+45,1]),
    actionRef(roll,[180-45,- 1]),
    actionRef(straight,[1]),
    actionRef(straight,[- 1]),
    wait(50),
    repeat(3*rank,[
      action([
        fire(none,some(spdAbs(0)),bullet(none,none,[actionRef(fin1,[1])])),
        fire(none,some(spdAbs(0)),bullet(none,none,[actionRef(fin1,[- 1])])),
        fire(none,none,bullet(none,none,[actionRef(white1,[])])),
        wait(5*(6+12*rank))
      ])
    ]),
    wait(110)
  ]),
  eaction(fin1,[actionRef(fin2,[$1]),vanish]),
  eaction(fin2,[
    fire(some(dirAim($1*90)),some(spdAbs(1.7+0.8*rank)),bullet(none,none,[])),
    wait(2 div (rank+0.2)),
    repeat(1+rank*32,[
      action([
        fire(some(dirSeq(- 1* $1*(2.3 div (rank+0.01)+0.35))),some(spdAbs(1.7+0.8*rank)),bullet(none,none,[])),
        wait(2 div (rank+0.2))
      ])
    ])
  ]),
  eaction(white1,[
    fireRef(white2,[0,1.0e-5,0]),
    fireRef(white2,[90,1,1.5]),
    fireRef(white2,[- 90,1,- 1.5]),
    vanish
  ]),
  efire(white2,fire(some(dirRel($1)),some(spdAbs($2)),bullet(none,none,[
    action([
      wait(4),
      changeSpeed(spdAbs(1.0e-5),1),
      wait(83-70*rank),
      repeat(6+12*rank,[
        action([
          fire(some(dirRel(- 1* $1+ $3)),some(spdAbs(2.9)),bullet(none,none,[])),
          wait(5)
        ])
      ]),
      vanish
    ])
  ]))),
  eaction(bara,[
    fireRef('5c',[44* $1,4.1,4]),
    fireRef('5c',[55.5* $1,3.45,3]),
    fireRef('5c',[55* $1,4.2,2]),
    fireRef('5c',[70* $1,3,0]),
    fireRef('5c',[68* $1,3.74,1])
  ]),
  efire('5c',fire(some(dirAbs(180+ $1)),some(spdAbs($2 div 1.1)),bullet(none,none,[
    action([
      wait(10),
      changeSpeed(spdAbs(0),1),
      wait(5+ $3*5),
      repeat(10-5 div (rank+0.001),[action([repeat(3,[actionRef(almond1,[])]),wait(85-40*rank)])]),
      vanish
    ])
  ]))),
  eaction(almond1,[
    fire(some(dirAim(3.5-7*rand)),some(spdAbs(0+0.3*rand)),bulletRef(almond2,[])),
    wait(3)
  ]),
  ebullet(almond2,bullet(none,none,[action([changeSpeed(spdRel(1.8+0.8*rank),10)])])),
  eaction('3way',[
    fire(some(dirAbs(180+ $2)),some(spdAbs(3.5)),bullet(none,none,[
      action([
        wait(10),
        changeSpeed(spdAbs(0),1),
        wait(1),
        repeat(7+10*rank,[
          action([
            fireRef('9way',[$1+16]),
            fireRef('9way',[$1]),
            fireRef('9way',[$1-16]),
            wait(25)
          ])
        ]),
        vanish
      ])
    ]))
  ]),
  efire('9way',fire(some(dirAbs($1)),some(spdAbs(1.5)),bullet(none,none,[]))),
  eaction(roll,[
    fire(some(dirAbs(180+11* $2)),some(spdAbs(10)),bullet(none,none,[
      action([
        wait(5),
        changeSpeed(spdAbs(0),1),
        wait(1),
        fire(some(dirAbs($1)),some(spdAbs(1.5)),bullet(none,none,[])),
        fire(some(dirAbs($1+30* $2)),some(spdAbs(1.5)),bullet(none,none,[])),
        wait(15),
        repeat(11+17*rank,[
          action([
            fire(some(dirSeq(- 35* $2)),some(spdAbs(1.5)),bullet(none,none,[])),
            fire(some(dirSeq(30* $2)),some(spdAbs(1.5)),bullet(none,none,[])),
            wait(15)
          ])
        ]),
        vanish
      ])
    ]))
  ]),
  eaction(straight,[
    fire(some(dirAbs(180+82* $1)),some(spdAbs(2.7)),bullet(none,none,[
      action([
        wait(13),
        changeSpeed(spdAbs(0),1),
        wait(1),
        repeat(3+5*rank,[actionRef(fall,[])]),
        vanish
      ])
    ]))
  ]),
  eaction(fall,[
    repeat(7,[
      action([fire(some(dirAbs(180)),some(spdAbs(2.9)),bullet(none,none,[])),wait(5)])
    ]),
    wait(15)
  ])
]).
