bulletML(vertical,[
  'Stop':action([changeSpeed(spdAbs(0),1)]),
  'Dummy':bullet(dirAim(0),spdAbs(1),[action([vanish])]),
  blue:bullet(dirAim(0),spdAbs(3),[
    action([
      wait(10),
      actionRef('Stop',[]),
      repeat(16+ $rank*16,[
        action([
          wait(10- $rank*4+ $rand),
          repeat(3,[
            action([
              fire(dirSeq(95),spdAbs(1.4),bullet(dirAim(0),spdAbs(1),[])),
              repeat(3,[action([fire(dirSeq(10),spdAbs(1.4),bullet(dirAim(0),spdAbs(1),[]))])])
            ])
          ])
        ])
      ]),
      vanish
    ])
  ]),
  xway:action([
    fire(dirAim(- 7* $1-7),spdAbs(1),bulletRef('Dummy',[])),
    repeat($1,[
      action([
        fire(dirSeq(15),spdAbs(1.3),bullet(dirAim(0),spdAbs(1),[action([])])),
        repeat(4,[
          action([
            fire(dirSeq(0),spdSeq(0.08+ $rank*0.08),bullet(dirAim(0),spdAbs(1),[action([])]))
          ])
        ])
      ])
    ])
  ]),
  red:bullet(dirAim(0),spdAbs(3),[
    action([
      wait(10),
      actionRef('Stop',[]),
      repeat(5,[action([actionRef(xway,[$rand*3+ $rank*2]),wait(40)])]),
      vanish
    ])
  ]),
  top:action([
    fire(dirAbs(120),spdAbs(1),bulletRef(blue,[])),
    fire(dirAbs(- 120),spdAbs(1),bulletRef(red,[])),
    wait(200),
    fire(dirAbs(- 120),spdAbs(1),bulletRef(blue,[])),
    fire(dirAbs(120),spdAbs(1),bulletRef(red,[])),
    wait(200)
  ])
]).
