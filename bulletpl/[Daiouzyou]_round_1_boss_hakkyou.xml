bulletML(vertical,[
  eaction(top1,[repeat(128,[action([wait(4),actionRef(four,[rand*90+135])])])]),
  eaction(four,[
    fire(some(dirAbs(90)),some(spdAbs(6)),bulletRef(rb,[$1])),
    repeat(3,[action([fire(some(dirSeq(60)),some(spdAbs(6)),bulletRef(rb,[$1]))])])
  ]),
  ebullet(rb,bullet(none,none,[actionRef(red,[$1+rand*20-10])])),
  eaction(red,[
    wait(1),
    fire(some(dirAbs($1)),some(spdAbs(1+rank)),bullet(none,none,[])),
    vanish
  ]),
  eaction(top2,[
    repeat(4,[action([wait(160),fire(none,none,bulletRef(sht,[1.2])),wait(80)])])
  ]),
  ebullet(sht,bullet(none,none,[
    action([
      repeat(16,[
        action([
          fire(some(dirAim(rand*16-8)),some(spdAbs(($1+rand* $1)*(rank div 2+0.65))),bullet(none,none,[]))
        ])
      ]),
      vanish
    ])
  ])),
  eaction(top3,[
    repeat(4,[
      action([
        fire(some(dirAbs(90)),none,bulletRef(rd_seed,[- 5,- 5])),
        fire(some(dirAbs(270)),none,bulletRef(rd_seed,[5,5])),
        wait(240)
      ])
    ])
  ]),
  ebullet(rd_seed,bullet(none,some(spdAbs(3)),[
    action([
      wait(1),
      fire(none,some(spdAbs(0)),bulletRef(rd_seed2,[])),
      fire(none,some(spdAbs(0)),bulletRef(bd_seed,[0,$2])),
      fire(none,some(spdAbs(0)),bulletRef(bd_seed,[$1,$2])),
      vanish
    ])
  ])),
  ebullet(rd_seed2,bullet(none,none,[
    action([
      repeat(5,[
        action([
          repeat(3,[
            action([fire(some(dirAbs(180)),some(spdAbs(1.2)),bullet(none,none,[])),wait(4)])
          ]),
          wait(12)
        ])
      ]),
      vanish
    ])
  ])),
  ebullet(bd_seed,bullet(none,none,[
    action([
      fire(some(dirAim($2)),some(spdAbs(0.6)),bullet(none,none,[])),
      repeat(11,[
        action([fire(some(dirSeq($1)),some(spdSeq(0.2)),bullet(none,none,[])),wait(4)])
      ]),
      vanish
    ])
  ]))
]).
